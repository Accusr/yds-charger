# 四路桌面智能充电站

> 这是一个实用型智能充电器项目
>
> 视频介绍：[【开源】如何自制一个全能桌面充电站？](https://www.bilibili.com/video/BV1X94y1U7av/)
>
> 如果觉得视频还可以的话，留下一键三连哦 ( ˊ•̥▵•)੭₎₎
>
> 本项目欢迎复刻，禁止商用！！
>
> 整体成本（纯硬件）在50元左右，目前没有贵的离谱芯片，选用的芯片基本都是国产使用量较高的

![5E3306F0C8ED8A1241D5FD975B7F77DC](https://raw.githubusercontent.com/liaozhelin/picgo/master/5E3306F0C8ED8A1241D5FD975B7F77DC.png)

**仓库目录说明**

1. Hardware：【上层板/下层板/前面板/后面板 】gerber文件/原理图源文件/原理图PDF文件/坐标文件/BOM文件
2. Firmware：【 ESP32C3FN4 的固件以及工具 】固件/驱动/下载烧录软件
3. Software： 【 软件工程源码 】esp-idf-4.4 版本开发环境
4. Structure： 【 整机结构文件 】包含电路板及外壳装配文件，软件版本Soliworks2022
5. Documents： 【 项目所用到的文档手册等 】部分手册，有些手册是厂家不让流传的没有上传

**资料说明 （更新日期22-5-28）**

- 已添加gerber文件，包含上层版，下层板，前面板，后面板，可直接打样（上层板若审核不通过备注断板不补即可）
- 已添加原理图源文件
- 已添加 README 文件 
- 已添加烧录软件,bootloader固件以及app固件
- 已添加结构设计文件夹
- 已添加手册文件夹
- 已添加 esp32c3 usb cdc/jtag驱动文件
- 已添加源码工程文件夹，希望大佬们可以帮忙改进，代码里有什么错误以及疑问都可以提交issue交流，当然能帮我完善功能就更好了😊

## 项目介绍：

### 1.1 硬件选型：

> 本项目的硬件购买都来自于淘宝，虽然有可能有假货，但是我没有翻车，大家可以酌情选择。

- 项目控制核心采用乐鑫**ESP32C3**芯片作为控制MCU，具备Wifi和Bluetooth，价格便宜功能强大，后期可供二次开发增加特定的功能(内置4M大FLASH)。
- C口功率级采用了智融**SW3526**的功率芯片（4.5元一片😍），该芯片内置多种快充协议，芯片内部集成功率管可以减少PCB面积，最大功率为单通道65W，本项目中设计了两路通道。
- A口功率级采用了英集芯的**IP6525T**，该芯片内置多种快充协议，价格低廉（1元一片😍），最大功率为单通道18W，本项目中设计了两路, 设计在机身后部, 主要是给桌面上的固定设备供电, 比如台灯, 小服务器等, 可通过MOS管远程控制开关
- 交互界面显示屏采用了**0.96**寸OLED屏（尺寸刚好,至于烧屏问题后面会通过屏保解决）。
- 输入部分设计了保护电路，具备防反接（方便车充应用）功能，反接系统不会工作。具备过流保护电路（10A），过流会熔断保险丝。具备防打火缓启动电路，可以防止上电火花。
- 板载四路RGB指示灯以及面板，可以实现当前系统状态的快速指示。
- 加速度传感器为**LIS3DH**，可以实现震动控制或者体感操作等功能。

![3](https://raw.githubusercontent.com/liaozhelin/picgo/master/3.jpg)

### 1.2 项目参数

输入电压：10V-32V直流 (推荐使用换下来的笔记本充电器,咸鱼便宜量大,当然更推荐24V5A台达电源,可以最大程度发挥功率)

输入功率：＞80W

快充参数如下：

- C口输出协议：PPS/PD3.0/PD2.0/QC4+/QC4/QC3.0/QC2.0/AFC/FCP/SCP/PE2.0/PE1.1/SFCP/BC2.1/苹果/三星
- C口输出电压：0.3-22V
- C口输出电流：0-3.3A
- A口输出协议：DCP/QC2.0/QC3.0/FCP/AFC
- A口输出电压：0.3-12V
- A口输出电流：0-3A

PCB参数：47*80(mm) 厚度1.6mm 四层板

整体尺寸（含外壳）：50X*20X*80(mm)

## 制作教程

### 2.1 制作注意事项

> 本产品焊接完成，测试无短路虚焊后，可通过下载口USB连接电脑，烧写程序后即可使用（ESP32C3自带内部USB和JTAG,十分方便）,如果不识别可能需要自行下载C3驱动安装即可

- 装机时请注意功率级部分的散热，推荐在功率级部分背面垫导热片增强散热能力。
- 焊接推荐采用钢网焊接，本项目中器件均为单面布置，可以快速实现低成本回流焊。
- 初次上电时，推荐使用5V电源，测量RY8411输出正常3.3V后才可以升高电压进行后面的测试。
- C1口为板载，C2口通过排针在上层板中引出。
- ESP32的固件还在不断完善中，基本功能都已经实现

### 2.2 固件烧录教程

> 通过Fireware/tools文件夹中的 flash_download_tool_3.9.2 工具下载
>
> 本项目暂时不提供源码下载以及PCB源文件，一个是资料还在整理，现在还不够规范

​	本项目不需要烧录器/下载器，只需要你有一个USB线，但是需要自己焊接一个降压电路将USB口的5V转到3.3V（或者不从排针3.3V处供电，直接通过DC口供电）,**一定不要把5V接到板子上的3.3V处，必烧ESP32**，我是使用了一个洞洞板+AMS1117焊接的简单下载器：

<img src="https://raw.githubusercontent.com/liaozhelin/picgo/master/image-20220528000844883.png" alt="image-20220528000844883" style="zoom: 15%;" />

​	固件位置在 Fireware/bin 中，软件打开后将设备连接到电脑

<img src="https://raw.githubusercontent.com/liaozhelin/picgo/master/image-20220528000432670.png" alt="image-20220528000432670" style="zoom: 30%;" />

​	按照下面的图片设置好软件，点击下载应该就可以下载固件了（如果出现连接错误可以将上板后面的拨动开关向左拨动不松，然后再上电，就会进Boot模式）

<img src="https://raw.githubusercontent.com/liaozhelin/picgo/master/image-20220528003317226.png" alt="image-20220528003317226" style="zoom: 10%;" />

​	ESP32 采用了 APP+OTA1+OTA2 的乒乓更新分区（这样就算更新到一半断电断网也不会变砖），可以实现远程更新，首次烧录完后续盖上盖子后，之后就可以使用无线更新了。

**功能开发（更新日期22-5-27）：**

✅ 已经开发完成   🚩正在开发中   ❌还未开发或放弃开发

|          设计功能          | 状态 |               说明               |
| :------------------------: | :--: | :------------------------------: |
|    远程网络升级（OTA）     |  ✅   |         带固件版本号校验         |
|          WIFI配网          |  ✅   |       通过ESPTouch软件配网       |
|         主界面显示         |  ✅   |        待机休眠屏保待完善        |
|        快充协议解析        |  ✅   |              已实现              |
|         RGB指示灯          |  ✅   |      已实现，控制逻辑待完善      |
|      各口电压电流监测      |  ✅   |              已实现              |
|        过流反接保护        |  ✅   |          以实现，已校验          |
|   远程控制充电器四口开关   |  🚩   |      硬件已验证，还未写逻辑      |
|     加速度计(重力感应)     |  🚩   |      程序已驱动，还未写功能      |
|        C口功率限制         |  🚩   |     程序已实现，界面还未增加     |
|    OTA自动检测版本升级     |  🚩   | 版本验证已完成，json解析还在修改 |
| 电脑CPU占用，内存占用显示  |  ❌   |             还未开发             |
|          天气显示          |  ❌   |             还未开发             |
|         粉丝数显示         |  ❌   |             还未开发             |
|        重力旋转屏幕        |  ❌   |             还未开发             |
| 蓝牙广播检测手环自动开关机 |  ❌   |             还未开发             |
|                            |      |                                  |
|                            |      |                                  |
|                            |      |                                  |

......

未完待续

......



> 本项目禁止商用，仅供同好们复刻使用，在制作项目时候，请确保硬件无故障再连接设备使用（我已经使用了两个月，目前没有出过问题，手头设备不是很多，所以测试可能不是很完善，不能保证系统不存在隐藏的问题。希望大家能发现问题一起改进），对于造成高价值设备损坏以及其他连带损失的的，本人不承担任何责任哈。
>
> 海拔高度：＜ 2000米
>
> 环境湿度：≤ 75% RH
>
> 工作环境：0℃ - 50摄氏度

纪念一下开发过程中的炮灰小弟们，第一代和第三代（总共迭代了5版本，其中有2代搬板拆了，剩下这两个完好的）：

<img src="https://raw.githubusercontent.com/liaozhelin/picgo/master/image-20220528181253005.png" alt="image-20220528181253005" style="zoom:50%;" />

